 WINDOWS FUNCTIONS

 1. RANKING (top 5 branch depositors)
 
 SELECT 
    c.branch_id,
    c.full_name,
    SUM(t.amount) AS total_deposits,
    RANK() OVER (PARTITION BY c.branch_id ORDER BY SUM(t.amount) DESC) AS deposit_rank
FROM customers c
JOIN accounts a ON c.customer_id = a.customer_id
JOIN transactions t ON a.account_id = t.account_id
WHERE t.txn_type = 'Deposit'
GROUP BY c.customer_id, c.full_name, c.branch_id
HAVING deposit_rank <= 5
ORDER BY c.branch_id, deposit_rank;

2. Aggregate Window Functions for Running monthly deposits per branch

SELECT 
    c.branch_id,
    DATE_FORMAT(t.txn_date, '%Y-%m') AS month,
    SUM(t.amount) AS monthly_deposit,
    SUM(SUM(t.amount)) OVER (
        PARTITION BY c.branch_id 
        ORDER BY DATE_FORMAT(t.txn_date, '%Y-%m')
        ROWS UNBOUNDED PRECEDING
    ) AS running_total
FROM customers c
JOIN accounts a ON c.customer_id = a.customer_id
JOIN transactions t ON a.account_id = t.account_id
WHERE t.txn_type = 'Deposit'
GROUP BY c.branch_id, month
ORDER BY c.branch_id, month;
3. Navigation Functions 

SELECT 
    c.customer_id,
    c.full_name,
    COUNT(t.transaction_id) AS txn_count,
    NTILE(4) OVER (ORDER BY COUNT(t.transaction_id) DESC) AS activity_quartile
FROM customers c
LEFT JOIN accounts a ON c.customer_id = a.customer_id
LEFT JOIN transactions t ON a.account_id = t.account_id
GROUP BY c.customer_id, c.full_name
ORDER BY txn_count DESC;
4. Distribution functions

SELECT 
    c.customer_id,
    c.full_name,
    COUNT(t.transaction_id) AS txn_count,
    NTILE(4) OVER (ORDER BY COUNT(t.transaction_id) DESC) AS activity_quartile
FROM customers c
LEFT JOIN accounts a ON c.customer_id = a.customer_id
LEFT JOIN transactions t ON a.account_id = t.account_id
GROUP BY c.customer_id, c.full_name
ORDER BY txn_count DESC;
